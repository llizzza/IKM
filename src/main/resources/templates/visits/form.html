<!--
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ó–∞–ø–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ | Fitness Pro"
–û–ø–∏—Å–∞–Ω–∏–µ: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ –ø–æ—Å–µ—â–µ–Ω–∏–π —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–∞.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Bootstrap 5 –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∏ Thymeleaf –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–∫–ª–∏–µ–Ω—Ç—ã, —Ç—Ä–µ–Ω–µ—Ä—ã, –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã).
-->

<page lang="ru" title="–ó–∞–ø–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ | Fitness Pro">

    <head>
        <meta charset="UTF-8"/>
        <title>–ó–∞–ø–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ | Fitness Pro</title>

        <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap –¥–ª—è —Å–µ—Ç–∫–∏ –∏ —Å—Ç–∏–ª–µ–π -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>

        <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã -->
        <styles>
            <body>
            background-color: #f0f8ff;
            font-family: 'Segoe UI', sans-serif;
            </body>

            <form-card>
                background: white;
                border-radius: 30px;
                box-shadow: 0 15px 35px rgba(33,150,243,0.1);
                border: none;
                overflow: hidden;
                margin-top: 30px;
            </form-card>

            <card-header>
                background: linear-gradient(135deg, #64b5f6 0%, #2196f3 100%);
                color: white;
                padding: 25px;
                border: none;
            </card-header>

            <form-label>
                color: #1565c0;
                font-weight: 600;
            </form-label>

            <form-control>
                border-radius: 12px;
                border: 1px solid #bbdefb;
                padding: 12px;
            </form-control>

            <btn-save>
                background: #2196f3;
                color: white;
                border-radius: 12px;
                border: none;
                padding: 12px;
                font-weight: bold;
                width: 100%;
                transition: 0.3s;
            </btn-save>

            <btn-save:hover>
                background: #1565c0;
                transform: translateY(-2px);
            </btn-save:hover>

            <alert-error>
                border-radius: 15px;
                background-color: #ffebee;
                color: #c62828;
                border: 1px solid #ef9a9a;
                padding: 15px;
                margin-bottom: 20px;
                text-align: center;
            </alert-error>
        </styles>
    </head>

    <body class="container py-4">

    <layout>
        <row class="justify-content-center">
            <col class="col-md-7">
            <card class="form-card shadow">

                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º—ã -->
                <card-header class="text-center">
                    <h3 class="mb-0">üìù –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª</h3>
                </card-header>

                <!-- –¢–µ–ª–æ —Ñ–æ—Ä–º—ã -->
                <card-body class="p-4">

                    <!-- –ë–ª–æ–∫ –æ—à–∏–±–∫–∏ -->
                    <alert th:if="${error}" class="alert-error">
                        <span th:text="${error}"></span>
                    </alert>

                    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
                    <form th:action="@{/visits/save}" th:object="${visit}" method="post" id="visitForm">

                        <!-- –í—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ -->
                        <form-group class="mb-3">
                            <label class="form-label">–ö–ª–∏–µ–Ω—Ç (–ê–±–æ–Ω–µ–º–µ–Ω—Ç)</label>
                            <select th:field="*{client}" class="form-select" id="clientSelect" required>
                                <option value="" data-purchase="" data-spec="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ --</option>
                                <option th:each="p : ${purchases}"
                                        th:value="${p.client.clientNumber}"
                                        th:attr="data-purchase=${p.purchaseDate}, data-spec=${p.seasonTicket.specialization.name}"
                                        th:text="${p.client.fullName} + ' ‚Äî [' + ${p.seasonTicket.specialization.name} + ']'">
                                </option>
                            </select>
                        </form-group>

                        <!-- –í—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ -->
                        <form-group class="mb-3">
                            <label class="form-label">–¢—Ä–µ–Ω–µ—Ä (—Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)</label>
                            <select th:field="*{coach}" class="form-select" id="coachSelect" required>
                                <option value="" data-spec="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ --</option>
                                <option th:each="coach : ${coaches}"
                                        class="coach-option"
                                        th:value="${coach.coachNumber}"
                                        th:attr="data-spec=${coach.specialization.name}"
                                        th:text="${coach.fullName} + ' (' + ${coach.specialization.name} + ')'">
                                </option>
                            </select>
                        </form-group>

                        <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏—è -->
                        <form-group class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏—è</label>
                            <row class="g-2">
                                <col class="col-md-6">
                                <input type="date" id="uiDate" class="form-control" required>
                                </col>
                                <col class="col-md-3">
                                <select id="uiHour" class="form-select" required>
                                    <option th:each="h : ${#numbers.sequence(7, 22)}"
                                            th:value="${h < 10 ? '0'+h : h}" th:text="${h < 10 ? '0'+h : h}"></option>
                                </select>
                                </col>
                                <col class="col-md-3">
                                <select id="uiMinute" class="form-select" required>
                                    <option value="00">00</option>
                                    <option value="15">15</option>
                                    <option value="30">30</option>
                                    <option value="45">45</option>
                                </select>
                                </col>
                            </row>
                            <input type="hidden" th:field="*{visitDate}" id="finalVisitDate">
                        </form-group>

                        <!-- –°—Ç–∞—Ç—É—Å –≤–∏–∑–∏—Ç–∞ -->
                        <form-group class="mb-4">
                            <label class="form-label">–°—Ç–∞—Ç—É—Å –≤–∏–∑–∏—Ç–∞</label>
                            <select th:field="*{attended}" class="form-select">
                                <option value="–ü—Ä–∏—à–µ–ª">‚úÖ –ü—Ä–∏—à–µ–ª</option>
                                <option value="–ù–µ –ø—Ä–∏—à–µ–ª">‚ùå –ù–µ –ø—Ä–∏—à–µ–ª</option>
                            </select>
                        </form-group>

                        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                        <button type="submit" class="btn btn-save shadow">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>

                        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–º–µ–Ω—É -->
                        <div class="text-center mt-3">
                            <a th:href="@{/visits}" class="text-muted small text-decoration-none">‚Ü© –û—Ç–º–µ–Ω–∞</a>
                        </div>

                    </form>
                </card-body>
            </card>
            </col>
        </row>
    </layout>

    <!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏ —Ñ–æ—Ä–º—ã -->
    <script>
        const clientSelect = document.getElementById('clientSelect');
        const coachSelect = document.getElementById('coachSelect');
        const coachOptions = document.querySelectorAll('.coach-option');
        const dateInput = document.getElementById('uiDate');

        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('max', today);

        // –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–æ–≤ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        clientSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const purchaseDate = selectedOption.getAttribute('data-purchase');
            const clientSpec = selectedOption.getAttribute('data-spec');

            coachSelect.value = "";

            coachOptions.forEach(option => {
                const coachSpec = option.getAttribute('data-spec');
                if (!clientSpec || coachSpec === clientSpec) {
                    option.style.display = 'block';
                    option.disabled = false;
                } else {
                    option.style.display = 'none';
                    option.disabled = true;
                }
            });

            if (purchaseDate) {
                dateInput.setAttribute('min', purchaseDate);
                if (dateInput.value && dateInput.value < purchaseDate) {
                    dateInput.value = purchaseDate;
                }
            } else {
                dateInput.removeAttribute('min');
            }
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏—è –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        document.getElementById('visitForm').onsubmit = function() {
            const date = document.getElementById('uiDate').value;
            const hour = document.getElementById('uiHour').value;
            const min = document.getElementById('uiMinute').value;
            if(date && hour && min) {
                document.getElementById('finalVisitDate').value = date + 'T' + hour + ':' + min;
            }
        };
    </script>

    </body>
</page>
